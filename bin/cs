#! /bin/bash -e

OPTS=("--exclude-dir=.git")
while getopts "d:x:i" opt; do
  case "$opt" in
    d) DIRS+=("$OPTARG");;
    x) EXTS+=("--include=*.$OPTARG");;
    i) OPTS+=("-i");;
  esac
done

shift $((OPTIND-1))
for arg in "$@"; do
  PATS+=("-e" "$arg")
done

if [ ${#PATS[@]} -eq 0 ]; then
  echo "No pattern given!" >&2
  exit 1
fi

if [ ${#DIRS[@]} -eq 0 ]; then
  DIRS+=(".")
fi

grep -Irn --color=auto "${OPTS[@]}" "${EXTS[@]}" "${PATS[@]}" "${DIRS[@]}"
